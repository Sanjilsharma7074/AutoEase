# Car Rental Service

A comprehensive, full-stack car rental management system with advanced authentication, role-based access control, and real-time updates. Built for scalability and ease of use.

## ğŸ“‹ Table of Contents

- [Features](#-features)
- [Tech Stack](#-tech-stack)
- [Prerequisites](#-prerequisites)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [Project Structure](#-project-structure)
- [Getting Started](#-getting-started)
- [User Roles & Permissions](#-user-roles--permissions)
- [API Endpoints](#-api-endpoints)
- [Super Admin Features](#-super-admin-features)
- [Database Schema](#-database-schema)
- [Troubleshooting](#-troubleshooting)
- [Contributing](#-contributing)
- [License](#-license)

## âœ¨ Features

### Core Features

- **User Authentication**

  - Email/Password registration with OTP verification
  - Google OAuth 2.0 integration
  - JWT-based token authentication
  - Secure password hashing with bcryptjs

- **Car Management**

  - Browse available cars with detailed information
  - Filter by car type (sedan, SUV, hatchback)
  - Real-time availability checking
  - Admin dashboard for car inventory management

- **Booking System**

  - Easy car booking with date selection
  - Pickup/dropoff location management
  - Distance calculation between locations
  - Booking history and management
  - Cancel bookings with confirmation

- **User Roles**

  - **Customer**: Browse cars, make bookings, manage personal bookings
  - **Admin**: Manage all cars, view all bookings, cancel bookings
  - **Super Admin**: Create admin accounts, manage entire admin system

- **Real-time Updates**

  - WebSocket (Socket.IO) integration for live booking notifications
  - Instant updates across multiple admin users

- **Email Notifications**
  - OTP delivery for email verification
  - Booking confirmations (ready for implementation)

## ğŸ›  Tech Stack

### Backend

- **Runtime**: Node.js v22.12.0
- **Framework**: Express.js 4.x
- **Database**: MongoDB with Mongoose ODM
- **Authentication**: JWT, bcryptjs, Passport.js, Google OAuth 2.0
- **Real-time**: Socket.IO
- **Email**: Nodemailer
- **Utilities**: dotenv, cors

### Frontend

- **Markup**: HTML5 with EJS templating
- **Styling**: CSS3 with responsive design
- **Client-side Logic**: Vanilla JavaScript (ES6+)
- **HTTP Client**: Fetch API
- **Icons**: Font Awesome 6.0

### DevOps

- **Development Server**: Nodemon
- **Package Manager**: npm
- **Version Control**: Git

## ğŸ“¦ Prerequisites

- Node.js v14 or higher
- npm or yarn
- MongoDB (local or Atlas cloud database)
- Google OAuth credentials (for Google sign-in)
- Email service credentials (for OTP delivery)

## ğŸš€ Installation

### 1. Clone the Repository

```bash
git clone <repository-url>
cd carRental
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Create Environment File

Create a `.env` file in the root directory:

```env
# Server Configuration
PORT=5000
NODE_ENV=development

# Database
MONGO_URI=mongodb://localhost:27017/carRental
# Or for MongoDB Atlas:
# MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/carRental

# Authentication
JWT_SECRET=your_jwt_secret_key_here

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_CALLBACK_URL=http://localhost:5000/auth/google/callback

# Email Service (Gmail example)
EMAIL_SERVICE=gmail
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_FROM=noreply@carrental.com
```

### 4. Create Super Admin Account

```bash
node seedSuperAdmin.js
```

**Output:**

```
âœ… Super Admin account created successfully!
==========================================
Email: [auto-generated during setup]
Password: [auto-generated during setup]
Role: superadmin
==========================================
âš ï¸  Keep these credentials secure and share only with authorized administrators.
```

The super admin credentials are generated by the seed script and will be displayed in your terminal. **Save them securely** and do not commit them to version control.

## âš™ï¸ Configuration

### MongoDB Connection

- **Local**: `mongodb://localhost:27017/carRental`
- **Atlas**: `mongodb+srv://username:password@cluster.mongodb.net/dbname?retryWrites=true&w=majority`

### Google OAuth Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project
3. Enable Google+ API
4. Create OAuth 2.0 credentials (Web application)
5. Add authorized redirect URIs:
   - `http://localhost:5000/auth/google/callback` (development)
   - `https://yourdomain.com/auth/google/callback` (production)

### Email Configuration

For Gmail:

1. Enable 2-factor authentication
2. Generate an [App Password](https://myaccount.google.com/apppasswords)
3. Use the app password in `.env`

## ğŸ“ Project Structure

```
carRental/
â”œâ”€â”€ models/                 # Database schemas
â”‚   â”œâ”€â”€ User.js            # User schema (customer, admin, superadmin)
â”‚   â”œâ”€â”€ Car.js             # Car inventory schema
â”‚   â””â”€â”€ Booking.js         # Booking transactions schema
â”‚
â”œâ”€â”€ Routes/                # API and view routes
â”‚   â”œâ”€â”€ authRoutes.js      # Authentication endpoints
â”‚   â”œâ”€â”€ carRoutes.js       # Car management endpoints
â”‚   â”œâ”€â”€ bookingRoutes.js   # Booking endpoints
â”‚   â”œâ”€â”€ userRoutes.js      # User profile endpoints
â”‚   â””â”€â”€ viewRoutes.js      # EJS view routes
â”‚
â”œâ”€â”€ middleware/            # Custom middleware
â”‚   â”œâ”€â”€ auth.js           # JWT authentication & role verification
â”‚   â””â”€â”€ passport.js       # Passport.js strategy configuration
â”‚
â”œâ”€â”€ services/             # Business logic services
â”‚   â””â”€â”€ emailService.js   # OTP generation and email delivery
â”‚
â”œâ”€â”€ views/               # EJS templates
â”‚   â”œâ”€â”€ layout.ejs       # Base layout template
â”‚   â”œâ”€â”€ index.ejs        # Homepage
â”‚   â”œâ”€â”€ login.ejs        # Login page
â”‚   â”œâ”€â”€ signup.ejs       # Registration page
â”‚   â”œâ”€â”€ verify-otp.ejs   # Email verification
â”‚   â”œâ”€â”€ cars.ejs         # Car listing and booking
â”‚   â”œâ”€â”€ bookings.ejs     # User bookings
â”‚   â”œâ”€â”€ admin.ejs        # Admin dashboard
â”‚   â”œâ”€â”€ superadmin.ejs   # Super admin dashboard
â”‚   â””â”€â”€ editCar.ejs      # Car editing
â”‚
â”œâ”€â”€ public/              # Static assets
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css    # Global styles
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ auth.js      # Auth & navigation logic
â”‚       â””â”€â”€ main.js      # Utilities & Socket.IO
â”‚
â”œâ”€â”€ server.js            # Express app setup & server start
â”œâ”€â”€ seedSuperAdmin.js    # Super admin account creation script
â”œâ”€â”€ seedCars.js          # Car inventory seed script
â”œâ”€â”€ package.json         # Dependencies & scripts
â””â”€â”€ .env                 # Environment variables (gitignored)
```

## ğŸ¯ Getting Started

### 1. Start MongoDB

```bash
# If using local MongoDB
mongod
```

### 2. Start the Server

**Development (with auto-reload):**

```bash
npm start
# Or with nodemon
nodemon server.js
```

**Production:**

```bash
NODE_ENV=production node server.js
```

Server runs on: `http://localhost:5000`

### 3. Access the Application

- **Homepage**: http://localhost:5000
- **Login**: http://localhost:5000/login
- **Sign Up**: http://localhost:5000/signup
- **Browse Cars**: http://localhost:5000/cars

## ğŸ‘¥ User Roles & Permissions

### Customer (user)

- âœ… Browse available cars
- âœ… Book cars with date selection
- âœ… View personal booking history
- âœ… Cancel own bookings
- âœ… Update profile

### Admin (admin)

- âœ… All customer features
- âœ… Add/edit/delete cars
- âœ… View all bookings
- âœ… Cancel any booking
- âœ… Manage inventory
- âŒ Cannot create other admins

### Super Admin (superadmin)

- âœ… All admin features
- âœ… **Create new admin accounts**
- âœ… View all admin accounts
- âœ… Delete admin accounts
- âœ… Manage entire admin system
- âœ… Access Super Admin Dashboard (`/superadmin`)

## ğŸ”Œ API Endpoints

### Authentication

```
POST   /auth/signup              Register new customer account
POST   /auth/verify-otp          Verify email with OTP
POST   /auth/resend-otp          Resend OTP to email
POST   /auth/login               Login (email & password)
GET    /auth/google              Google OAuth sign-in
POST   /auth/create-admin        Create admin account (super admin only)
GET    /auth/admins              List all admins (super admin only)
DELETE /auth/admin/:id           Delete admin account (super admin only)
```

### Cars

```
GET    /api/cars                 Get all available cars
POST   /api/cars                 Create new car (admin only)
GET    /api/cars/:id             Get car details
PUT    /api/cars/:id             Update car (admin only)
DELETE /api/cars/:id             Delete car (admin only)
```

### Bookings

```
POST   /api/bookings             Create new booking
GET    /api/bookings/my-bookings Get user's bookings
PUT    /api/bookings/cancel/:id  Cancel a booking
GET    /api/bookings/all         Get all bookings (admin only)
```

### Views

```
GET    /                         Homepage
GET    /login                    Login page
GET    /signup                   Signup page
GET    /cars                     Car listing
GET    /bookings                 User bookings
GET    /admin                    Admin dashboard (admin only)
GET    /superadmin               Super admin dashboard (super admin only)
```

## ğŸ¦¸ Super Admin Features

### Creating Admin Accounts

1. **Login** with super admin credentials (saved from seed script output)

2. **Navigate** to Super Admin Dashboard: `/superadmin`

3. **Fill Form** with new admin details:

   - Full Name
   - Email
   - Password (min. 6 characters)

4. **Click** "Create Admin Account"

5. **Share** login credentials with the new admin securely

### Managing Admin Accounts

- **View All**: See all active admin accounts with creation dates
- **Delete**: Remove admin account (requires confirmation)
- **Fallback**: If super admin credentials lost, re-run `node seedSuperAdmin.js` to regenerate

## ğŸ“Š Database Schema

### User

```javascript
{
  name: String,
  email: String (unique),
  password: String (hashed),
  role: "superadmin" | "admin" | "user",
  emailVerified: Boolean,
  otp: String,
  otpExpiry: Date,
  googleId: String,
  profilePhoto: String,
  createdAt: Date
}
```

### Car

```javascript
{
  model: String,
  type: "sedan" | "suv" | "hatchback",
  pricePerDay: Number,
  imageUrl: String,
  isAvailable: Boolean,
  createdAt: Date
}
```

### Booking

```javascript
{
  userId: ObjectId (ref: User),
  customerName: String,           // Snapshot at booking time
  customerEmail: String,          // Snapshot at booking time
  carId: ObjectId (ref: Car),
  startDate: Date,
  endDate: Date,
  status: "booked" | "cancelled",
  pickupLocation: String,
  dropoffLocation: String,
  pickupLat: Number,
  pickupLng: Number,
  dropoffLat: Number,
  dropoffLng: Number,
  distanceKm: Number,
  createdAt: Date
}
```

## ğŸ› Troubleshooting

### Port Already in Use

```bash
# Kill process on port 5000
# Windows:
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# Linux/Mac:
lsof -i :5000
kill -9 <PID>
```

### MongoDB Connection Error

- Verify MongoDB is running: `mongod`
- Check `MONGO_URI` in `.env`
- For Atlas: Ensure IP whitelist includes your IP

### Super Admin Not Found

```bash
node seedSuperAdmin.js
```

### Email Not Sending

1. Enable Less Secure App Access (Gmail)
2. Use App Password (Gmail with 2FA)
3. Check `EMAIL_SERVICE`, `EMAIL_USER`, `EMAIL_PASSWORD` in `.env`

### Token Expired

- JWT tokens expire after 24 hours
- Users will be auto-logged out
- Login again to get a new token

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/amazing-feature`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push to branch: `git push origin feature/amazing-feature`
5. Open a Pull Request

### Coding Standards

- Use ES6+ syntax
- Follow existing code style
- Add comments for complex logic
- Test thoroughly before submitting PR

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ“ Support

For issues, questions, or suggestions:

- Open an [GitHub Issue](https://github.com/yourusername/carRental/issues)
- Contact the development team

---

**Made with â¤ï¸ for seamless car rental management**

**Last Updated**: December 15, 2025

- `npm start` â€“ start with node

## Folder Structure (what lives where)

```
server.js               Express app entry, Mongo connection, Socket.IO
package.json            Scripts and dependencies
Routes/
	authRoutes.js         Email+OTP signup/verify/resend, JWT login, Google OAuth
	userRoutes.js         Basic register endpoint (mounted at /users)
	carRoutes.js          CRUD for cars (admin-only writes)
	bookingRoutes.js      Create/cancel/list bookings with overlap checks
	viewRoutes.js         EJS page routes
models/
	User.js               Fields: name, email, password (hashed), role, emailVerified, otp, googleId
	Car.js                Fields: model, type, pricePerDay, availability, imageUrl (placeholder default)
	Booking.js            Fields: userId, carId, startDate, endDate, status, locations, distance
middleware/
	auth.js               JWT verification and role guard
	passport.js           Google strategy (enabled when env vars are present)
services/
	emailService.js       OTP generation and delivery helper
public/                 CSS and client JS (auth helpers, page interactions)
views/                  EJS templates (index, cars, bookings, admin, login, signup, editCar, verify-otp, layout)
seedCars.js             Seeds ~21 cars with placeholder images
```

## API and Pages

- Auth (mounted at /auth): signup (OTP), verify-otp, resend-otp, login, Google OAuth callback in [Routes/authRoutes.js](Routes/authRoutes.js)
- Users (mounted at /users): register in [Routes/userRoutes.js](Routes/userRoutes.js)
- Cars (mounted at /api/cars): list (public), create/update/delete (admin) in [Routes/carRoutes.js](Routes/carRoutes.js)
- Bookings (mounted at /api/bookings): create, cancel, my-bookings, admin all-bookings in [Routes/bookingRoutes.js](Routes/bookingRoutes.js)
- Views (mounted at /): index, cars, bookings, admin, login, signup, verify-otp, edit-car in [Routes/viewRoutes.js](Routes/viewRoutes.js)

## Auth Flow

- Email signup: `POST /auth/signup` stores user with OTP -> `POST /auth/verify-otp` finalizes and returns JWT.
- Resend OTP: `POST /auth/resend-otp` for unverified users.
- Login: `POST /auth/login` returns JWT; JWT goes in `Authorization: Bearer <token>` for protected calls.
- Google OAuth: works only when GOOGLE_CLIENT_ID/SECRET are set; otherwise endpoints return a friendly message.
- Role guard: pass roles to middleware/auth.js (admin-only for car writes and booking list-all).

## Realtime Hooks

Socket.IO is initialized in [server.js](server.js); routes emit `booking:created` and `booking:cancelled` events when io is available via `app.locals.io`.

## Images

When no image is provided or loading fails, cars fall back to https://placehold.co/600x360?text=Car+Image (used in models and seeder; frontend also guards with onerror).

## Troubleshooting

- Connection errors: confirm MONGO_URI and network access (Atlas IP allowlist, etc.).
- Invalid token: ensure JWT_SECRET in .env matches the running process.
- Google OAuth: set GOOGLE_CLIENT_ID/SECRET and restart; otherwise endpoints will respond with a 503 message.
- Static assets missing: public/ must remain mounted; check references in views.

## Additional Docs

- SETUP_GUIDE.md â€“ environment and installation details
- IMPLEMENTATION_GUIDE.md â€“ implementation notes
- TESTING_GUIDE.md / QUICK_TEST.md â€“ lightweight test guidance

## Security & Secrets

- Use `.env.example` as a template and keep your real `.env` untracked (see `.gitignore`).
- If a secret is ever committed, GitHub Push Protection will block the push. Purge the secret from history using `git filter-repo` or BFG, then rotate the credential.
- Example to remove `.env` from history (requires git-filter-repo):
  - `git filter-repo --path .env --invert-paths`
  - `git push --force`

## License

ISC (see package.json).
